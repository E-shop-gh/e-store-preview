<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Duty Roster Scheduler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --duplicate-color: #ff6b6b;
            --adjacent-color: #6bff6b;
            --stats-color: #8e44ad;
            --splash-color: #1a5276;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }
        
        .container.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Splash Screen */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--splash-color), #154360);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        
        .splash-content {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            transform: scale(0.9);
            animation: scaleIn 1.2s forwards;
        }
        
        @keyframes scaleIn {
            to {
                transform: scale(1);
            }
        }
        
        .splash-title {
            font-size: 4rem;
            font-weight: 800;
            color: white;
            margin-bottom: 20px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            letter-spacing: 2px;
            animation: fadeInUp 1s ease forwards;
        }
        
        .splash-subtitle {
            font-size: 1.8rem;
            color: #f1c40f;
            font-weight: 600;
            margin-bottom: 40px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1.2s ease forwards;
            animation-delay: 0.2s;
            opacity: 0;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .splash-loader {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 8px solid #f1c40f;
            animation: spin 1.5s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .splash-note {
            color: #ecf0f1;
            font-size: 1.2rem;
            max-width: 600px;
            margin: 20px auto 0;
            animation: fadeInUp 1.4s ease forwards;
            animation-delay: 0.4s;
            opacity: 0;
        }
        
        /* Main App Styles */
        header {
            background: linear-gradient(to right, var(--primary-color), var(--dark-color));
            color: white;
            padding: 20px;
            position: relative;
            z-index: 10;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .month-indicator {
            font-size: 1.4rem;
            font-weight: 600;
            color: #f1c40f;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-block;
            margin-top: 5px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }
        
        .header-controls {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 10px 0;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            background: var(--secondary-color);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.active {
            background: var(--accent-color);
        }
        
        button.print {
            background: var(--success-color);
        }
        
        button.edit {
            background: var(--warning-color);
        }
        
        button.reset {
            background: #9b59b6;
        }
        
        button.add {
            background: #27ae60;
        }
        
        button.delete {
            background: #e74c3c;
        }
        
        button.import {
            background: #8e44ad;
        }
        
        button.export {
            background: #16a085;
        }
        
        button.stats {
            background: var(--stats-color);
        }
        
        button.info {
            background: #f39c12;
        }
        
        .search-container {
            flex-grow: 1;
            max-width: 300px;
            position: relative;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border-radius: 50px;
            border: 2px solid var(--secondary-color);
            font-size: 1rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        input[type="text"]:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.3);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
            font-size: 1.2rem;
        }
        
        .tabs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
            position: sticky;
            top: 0;
            z-index: 5;
        }
        
        .month-tab {
            padding: 8px 20px;
            background: #e9ecef;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
            white-space: nowrap;
        }
        
        .month-tab.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .month-tab:hover:not(.active) {
            background: #dee2e6;
        }
        
        .close-tab {
            background: rgba(0,0,0,0.2);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .close-tab:hover {
            background: rgba(0,0,0,0.3);
        }
        
        .table-container {
            background-color: white;
            overflow-x: auto;
            padding: 20px;
            position: relative;
            max-height: 65vh;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: center;
            border: 1px solid #e0e0e0;
            transition: var(--transition);
        }
        
        th {
            background: linear-gradient(to bottom, var(--primary-color), var(--dark-color));
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #f1f8ff;
        }
        
        .role-header {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            font-weight: 600;
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 2;
            width: 180px;
            min-width: 180px;
            max-width: 180px;
            cursor: pointer;
        }
        
        .role-header:hover {
            background: linear-gradient(to right, #2980b9, #2573a7);
        }
        
        .week-header {
            cursor: pointer;
        }
        
        .week-header:hover {
            background: linear-gradient(to bottom, #1a2a6c, #233d8d);
        }
        
        .current-week {
            background-color: #fffde7;
            box-shadow: inset 0 0 0 3px #ffd54f;
            position: relative;
        }
        
        .current-week::after {
            content: "Current";
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--accent-color);
            color: white;
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .highlight {
            background-color: rgba(231, 76, 60, 0.2);
            font-weight: bold;
            border-radius: 4px;
            padding: 2px 4px;
        }
        
        .editable-cell {
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
            min-width: 180px;
        }
        
        .editable-cell:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .editable-cell:focus {
            outline: 2px solid var(--secondary-color);
            background-color: white;
        }
        
        .copied-content {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .duplicate-highlight {
            background-color: rgba(255, 107, 107, 0.3);
            box-shadow: inset 0 0 0 2px var(--duplicate-color);
        }
        
        .adjacent-highlight {
            background-color: rgba(107, 255, 107, 0.3);
            box-shadow: inset 0 0 0 2px var(--adjacent-color);
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: #7f8c8d;
            font-size: 0.9rem;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background-color: var(--success-color);
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(200%);
            transition: transform 0.4s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .legend-duplicate {
            background-color: rgba(255, 107, 107, 0.3);
            border: 1px solid var(--duplicate-color);
        }
        
        .legend-adjacent {
            background-color: rgba(107, 255, 107, 0.3);
            border: 1px solid var(--adjacent-color);
        }
        
        .legend-copied {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background: linear-gradient(to right, var(--primary-color), var(--dark-color));
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.4rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .form-group input[type="text"] {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group input[type="file"] {
            width: 100%;
            padding: 10px 0;
        }
        
        .table-selector {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .table-option {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .table-option:last-child {
            border-bottom: none;
        }
        
        .table-option input {
            margin-right: 10px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-footer button {
            padding: 8px 20px;
        }
        
        /* Stats styles */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            border-left: 4px solid var(--stats-color);
        }
        
        .stats-card h3 {
            color: var(--stats-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .stats-table th {
            background: var(--stats-color);
            color: white;
            text-align: left;
            padding: 10px 15px;
        }
        
        .stats-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        
        .stats-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .stats-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .stats-table .rank {
            font-weight: bold;
            color: var(--stats-color);
            text-align: center;
        }
        
        .stats-table .count {
            font-weight: bold;
            text-align: center;
        }
        
        .stats-table .role-count {
            font-size: 0.9rem;
            color: #666;
        }
        
        .role-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .role-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .role-card h4 {
            color: var(--dark-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .role-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .role-card li {
            padding: 5px 0;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed #ddd;
        }
        
        .role-card li:last-child {
            border-bottom: none;
        }
        
        .role-card .count {
            font-weight: bold;
            color: var(--stats-color);
        }
        
        /* Instructions Modal */
        #instructionsModal .modal-content {
            max-width: 800px;
        }
        
        .instructions {
            background: linear-gradient(to right, #e0f7fa, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--secondary-color);
        }
        
        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .instructions li i {
            color: var(--success-color);
            margin-right: 8px;
        }
        
        @media (max-width: 900px) {
            .header-controls {
                flex-direction: column;
            }
            
            .btn-group {
                width: 100%;
                justify-content: center;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .role-header {
                width: 150px;
                min-width: 150px;
                max-width: 150px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .splash-title {
                font-size: 3rem;
            }
            
            .splash-subtitle {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .btn-group button {
                flex: 1 0 40%;
            }
            
            button {
                font-size: 0.85rem;
                padding: 8px 15px;
            }
            
            .app-title {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
            
            .role-header {
                width: 120px;
                min-width: 120px;
                max-width: 120px;
                font-size: 0.9rem;
                padding: 10px;
            }
            
            th, td {
                padding: 10px;
            }
            
            .splash-title {
                font-size: 2.2rem;
            }
            
            .splash-subtitle {
                font-size: 1.2rem;
            }
            
            .splash-loader {
                width: 60px;
                height: 60px;
            }
        }
        
        @media print {
            .header-controls, footer, .tabs-container, .legend {
                display: none;
            }
            
            .table-container {
                padding: 0;
                box-shadow: none;
            }
            
            table {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-content">
            <h1 class="splash-title">MWB ASSIGNMENTS SCHEDULE</h1>
            <h2 class="splash-subtitle">designed by Bro Mike Appiah</h2>
            <div class="splash-loader"></div>
            <p class="splash-note">Advanced scheduling tool for managing meeting assignments and duties</p>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="container">
        <header>
            <div class="app-title">
                <div>
                    <h1><i class="fas fa-calendar-alt"></i> Advanced Duty Roster Scheduler</h1>
                    <div class="month-indicator" id="monthIndicator">July 2025</div>
                </div>
            </div>
            
            <div class="header-controls">
                <div class="btn-group">
                    <button id="prevMonthBtn"><i class="fas fa-arrow-left"></i> Prev</button>
                    <button id="currentMonthBtn" class="active"><i class="fas fa-calendar-check"></i> Current</button>
                    <button id="nextMonthBtn">Next <i class="fas fa-arrow-right"></i></button>
                    <button id="printBtn" class="print"><i class="fas fa-print"></i> Print</button>
                    <button id="resetBtn" class="reset"><i class="fas fa-sync"></i> Reset</button>
                    <button id="addTableBtn" class="add"><i class="fas fa-plus"></i> Add Table</button>
                    <button id="exportBtn" class="export"><i class="fas fa-file-export"></i> Export</button>
                    <button id="importBtn" class="import"><i class="fas fa-file-import"></i> Import</button>
                    <button id="statsBtn" class="stats"><i class="fas fa-chart-bar"></i> Statistics</button>
                    <button id="infoBtn" class="info"><i class="fas fa-info-circle"></i> Help</button>
                </div>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search for names...">
                </div>
            </div>
        </header>
        
        <div class="tabs-container" id="tabsContainer">
            <!-- Month tabs will be generated here -->
        </div>
        
        <div class="table-container">
            <table id="rosterTable">
                <thead>
                    <tr>
                        <th>Role / Week</th>
                        <!-- Weeks will be populated by JavaScript -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Roster data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <footer>
            <p>Advanced Duty Roster Scheduler | CRUD Operations with LocalStorage | Created with HTML, CSS & JavaScript</p>
        </footer>
    </div>
    
    <div class="notification" id="notification">Changes saved successfully!</div>

    <!-- Add Table Modal -->
    <div class="modal" id="addTableModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Create New Table</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newTableName">Table Name:</label>
                    <input type="text" id="newTableName" placeholder="Enter table name (e.g., September 2025)">
                </div>
                <div class="form-group">
                    <label>Copy from existing table:</label>
                    <div class="table-selector" id="tableSelector">
                        <!-- Table options will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelAddTableBtn">Cancel</button>
                <button id="confirmAddTableBtn" class="add">Create Table</button>
            </div>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-import"></i> Import Data</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="importFile">Select JSON file to import:</label>
                    <input type="file" id="importFile" accept=".json">
                </div>
                <p><strong>Note:</strong> Importing will replace all existing data with the imported content.</p>
            </div>
            <div class="modal-footer">
                <button id="cancelImportBtn">Cancel</button>
                <button id="confirmImportBtn" class="import">Import Data</button>
            </div>
        </div>
    </div>
    
    <!-- Statistics Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> Assignment Statistics</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3><i class="fas fa-users"></i> Top Assignees</h3>
                        <table class="stats-table" id="topAssigneesTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Top assignees will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="stats-card">
                        <h3><i class="fas fa-tasks"></i> Role Distribution</h3>
                        <div id="roleBreakdown">
                            <!-- Role breakdown will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="stats-card" style="margin-top: 20px;">
                    <h3><i class="fas fa-user-tag"></i> Detailed Assignment Stats</h3>
                    <table class="stats-table" id="detailedStatsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Total</th>
                                <th>Role Breakdown</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Detailed stats will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeStatsBtn">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Instructions Modal -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> How to use this scheduler</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> How to use this scheduler</h3>
                    <ul>
                        <li><i class="fas fa-mouse-pointer"></i> Click on any assignment cell to edit names</li>
                        <li><i class="fas fa-heading"></i> Click on role names or week headers to edit them</li>
                        <li><i class="fas fa-save"></i> Changes are automatically saved to your browser</li>
                        <li><i class="fas fa-search"></i> Use search to highlight names across the schedule</li>
                        <li><i class="fas fa-plus"></i> Add new tables for additional months</li>
                        <li><i class="fas fa-copy"></i> Populate new tables from existing ones</li>
                        <li><i class="fas fa-trash"></i> Delete unnecessary tables</li>
                        <li><i class="fas fa-file-export"></i> Export/Import data to share across devices</li>
                        <li><i class="fas fa-chart-bar"></i> View detailed statistics for duty assignments</li>
                    </ul>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color legend-duplicate"></div>
                            <span>Duplicate names in same week</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-adjacent"></div>
                            <span>Same name in adjacent weeks</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-copied">Red text</span>
                            <span>Copied from another table</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeInstructionsBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data structure
        const defaultData = {
            july: {
                id: 'july',
                name: "July 2025",
                weeks: [
                    { range: "July 7 - 13", isCurrent: false },
                    { range: "July 14 - 20", isCurrent: false },
                    { range: "July 21 - 27", isCurrent: true },
                    { range: "July 28", isCurrent: false }
                ],
                roles: {
                    "Chairman": ["Derrick Yankson", "Anthony Entsie", "Isaac Newton", "Collins Yeboah"],
                    "Opening Prayer": ["Emmanuel Entsie", "Shadrach Asare", "Isaac Arhin", "Hilkiah Kwakye"],
                    "1": ["Emmanuel Asante", "Daniel Boakye", "Obed Gyamfi", "Alexander Bawuah"],
                    "2": ["Hilkiah Entsie", "Samuel Onwona", "Isaac Ampomah", "Ephraim Sam"],
                    "3": ["Michael Obeng", "Stanley Yamekpe", "John Essel", "Frank Essah"],
                    "4": ["Christiana Amponsah & Margaret Entsie", "Barbara Asamoah & Lois Fosu", "Dorah Asare & Victoria Yeboah", "Lilian Ankomah & Rosina Yankson"],
                    "5": ["Rebecca Agbenyo & Mercy Entsie", "Selina Gyamfi & Barbara Amponsah", "Nhyira Appiah & Jemimah Miezah", "Dzifa Alonya & Vivian Arhin"],
                    "6": ["Nacy Baidoo & Tracy Yeboah", "Paul Asiedu", "Reuben Sowolo & Francis Entsie", "Lois Sowolo & Alimatu Sadia"],
                    "7": ["Abel Eshun", "Alexander Bawuah", "Gideon Miezah", "Isaac Arhin"],
                    "8": ["Michael Appiah", "Wonder Sowolo", "Ahiade", "Wonder Sowolo"],
                    "9": ["", "", "Derrick Yankson", "Arhin Kingsley"],
                    "Closing Prayer": ["Dickson Onwona", "Isaac Ampomah", "Newton Sam", "Daniel Boakye"]
                },
                copiedFrom: null
            },
            august: {
                id: 'august',
                name: "August 2025",
                weeks: [
                    { range: "August 4 - 10", isCurrent: false },
                    { range: "August 11 - 17", isCurrent: false },
                    { range: "August 18 - 24", isCurrent: false },
                    { range: "August 25 - 31", isCurrent: false }
                ],
                roles: {
                    "Chairman": ["Dickson Onwona", "Wonder Sowolo", "Archibald Entsie", "Kingsley Arhin"],
                    "Opening Prayer": ["Ephraim Sam", "Kingsley Arhin", "Derrick Yankson", "Emmanuel Asante"],
                    "1": ["Hilkiah kwakye", "Samuel Onwona", "Michael Appiah", "Isaac Ampomah"],
                    "2": ["Obed Gyamfi", "Shadrach Asare", "Emmanuel Asante", "Gideon Miezah"],
                    "3": ["Stephen Essilfie", "Samuel Larbi", "Sadick Mohammed", "Ebenezer Normanyo"],
                    "4": ["Mawusi Appiah & Naomi Entsie", "Claudia Sam & Owusuwaa Appiah", "Joana Enstie & Gloria Adobea", "Mary Entsie & Adwoa Onwona"],
                    "5": ["Joana Ekwama & Adwoa Eshun", "Augusta Appiah & Mary Entsie", "Juliana Entsie & Adelaide Allotey", "Mercy Entsie & Cynthia Sam"],
                    "6": ["Shadrach Asare", "Foster Entsie & Ebenezer Normanyo", "Emmanuel Entsie", "Hannah & Claudia Polley"],
                    "7": ["Ahiade", "Ephraim Sam", "Obed Gyamfi", "Abigail Asieduwaa & Elizabeth Yeboah"],
                    "8": ["Archibald Enstie", "Anthony Entsie", "Collins Yeboah", "Daniel Boakye"],
                    "9": ["", "", "", "Ebel Eshun"],
                    "10": ["", "", "", "Dickson Onwona"],
                    "Closing Prayer": ["Reuben Sowolo", "Collins Yeboah", "Samuel Onwona", "Isaac Arhin"]
                },
                copiedFrom: null
            }
        };

        // Initialize app state
        let allMonthsData = {};
        let currentMonthId = 'july';
        let highlightedNames = new Set();
        
        // DOM Elements
        const tableBody = document.querySelector('#rosterTable tbody');
        const tableHead = document.querySelector('#rosterTable thead tr');
        const monthIndicator = document.getElementById('monthIndicator');
        const searchInput = document.getElementById('searchInput');
        const notification = document.getElementById('notification');
        const tabsContainer = document.getElementById('tabsContainer');
        const splashScreen = document.getElementById('splashScreen');
        const container = document.querySelector('.container');
        
        // Modal elements
        const addTableModal = document.getElementById('addTableModal');
        const importModal = document.getElementById('importModal');
        const statsModal = document.getElementById('statsModal');
        const instructionsModal = document.getElementById('instructionsModal');
        const newTableNameInput = document.getElementById('newTableName');
        const tableSelector = document.getElementById('tableSelector');
        const importFileInput = document.getElementById('importFile');
        const topAssigneesTable = document.getElementById('topAssigneesTable').querySelector('tbody');
        const detailedStatsTable = document.getElementById('detailedStatsTable').querySelector('tbody');
        const roleBreakdown = document.getElementById('roleBreakdown');
        
        // Initialize the app
        function initApp() {
            // Hide splash screen and show app after delay
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                splashScreen.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    container.classList.add('loaded');
                }, 800);
            }, 3000);
            
            loadFromLocalStorage();
            renderTabs();
            renderTable();
            setupEventListeners();
        }
        
        // Load data from localStorage or use default
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('mwbRosterData');
            if (savedData) {
                try {
                    allMonthsData = JSON.parse(savedData);
                    // Ensure at least one month exists
                    if (Object.keys(allMonthsData).length === 0) {
                        allMonthsData = JSON.parse(JSON.stringify(defaultData));
                    }
                } catch (e) {
                    console.error("Error parsing saved data, using default", e);
                    allMonthsData = JSON.parse(JSON.stringify(defaultData));
                }
            } else {
                allMonthsData = JSON.parse(JSON.stringify(defaultData));
            }
            
            // Set current month to first if not set
            if (!allMonthsData[currentMonthId]) {
                currentMonthId = Object.keys(allMonthsData)[0];
            }
        }
        
        // Save data to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('mwbRosterData', JSON.stringify(allMonthsData));
            showNotification('Changes saved successfully!');
        }
        
        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Render the month tabs
        function renderTabs() {
            tabsContainer.innerHTML = '';
            
            Object.keys(allMonthsData).forEach(monthId => {
                const month = allMonthsData[monthId];
                const tab = document.createElement('div');
                tab.className = `month-tab ${monthId === currentMonthId ? 'active' : ''}`;
                tab.dataset.monthId = monthId;
                tab.innerHTML = `
                    ${month.name}
                    <div class="close-tab" data-month-id="${monthId}">Ã—</div>
                `;
                tabsContainer.appendChild(tab);
            });
            
            // Add event listeners to tabs
            document.querySelectorAll('.month-tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('close-tab')) {
                        currentMonthId = this.dataset.monthId;
                        renderTabs();
                        renderTable();
                    }
                });
            });
            
            // Add event listeners to close buttons
            document.querySelectorAll('.close-tab').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const monthId = this.dataset.monthId;
                    deleteTable(monthId);
                });
            });
        }
        
        // Delete a table
        function deleteTable(monthId) {
            if (Object.keys(allMonthsData).length <= 1) {
                showNotification('You need at least one table!');
                return;
            }
            
            if (confirm(`Are you sure you want to delete the "${allMonthsData[monthId].name}" table?`)) {
                delete allMonthsData[monthId];
                
                // Set current month to another one
                currentMonthId = Object.keys(allMonthsData)[0];
                
                saveToLocalStorage();
                renderTabs();
                renderTable();
                showNotification('Table deleted successfully!');
            }
        }
        
        // Open Add Table modal
        function openAddTableModal() {
            // Populate table selector
            tableSelector.innerHTML = '';
            
            // Add "Empty Table" option
            const emptyOption = document.createElement('div');
            emptyOption.className = 'table-option';
            emptyOption.innerHTML = `
                <input type="radio" name="sourceTable" id="emptyTable" value="" checked>
                <label for="emptyTable">Create Empty Table</label>
            `;
            tableSelector.appendChild(emptyOption);
            
            // Add existing tables as options
            Object.keys(allMonthsData).forEach(monthId => {
                const month = allMonthsData[monthId];
                const option = document.createElement('div');
                option.className = 'table-option';
                option.innerHTML = `
                    <input type="radio" name="sourceTable" id="${monthId}" value="${monthId}">
                    <label for="${monthId}">${month.name}</label>
                `;
                tableSelector.appendChild(option);
            });
            
            // Reset input
            newTableNameInput.value = '';
            
            // Show modal
            addTableModal.style.display = 'flex';
        }
        
        // Create new table from modal
        function createNewTable() {
            const tableName = newTableNameInput.value.trim();
            if (!tableName) {
                showNotification('Please enter a table name');
                return;
            }
            
            const sourceTableRadio = document.querySelector('input[name="sourceTable"]:checked');
            const sourceMonthId = sourceTableRadio.value;
            
            const monthId = 'month_' + Date.now();
            let weeks = [];
            let roles = {};
            let copiedFrom = null;
            
            if (sourceMonthId && allMonthsData[sourceMonthId]) {
                // Copy structure and content
                const source = allMonthsData[sourceMonthId];
                weeks = JSON.parse(JSON.stringify(source.weeks));
                roles = JSON.parse(JSON.stringify(source.roles));
                copiedFrom = sourceMonthId;
            } else {
                // Create consistent structure based on current month
                const currentMonth = allMonthsData[currentMonthId];
                weeks = JSON.parse(JSON.stringify(currentMonth.weeks));
                roles = {};
                
                // Clear week indicators for new month
                weeks.forEach(week => week.isCurrent = false);
                
                // Create empty assignments matching current table structure
                for (const role in currentMonth.roles) {
                    roles[role] = Array(weeks.length).fill("");
                }
            }
            
            allMonthsData[monthId] = {
                id: monthId,
                name: tableName,
                weeks: weeks,
                roles: roles,
                copiedFrom: copiedFrom
            };
            
            currentMonthId = monthId;
            
            saveToLocalStorage();
            renderTabs();
            renderTable();
            showNotification('Table added successfully!');
            
            // Close modal
            addTableModal.style.display = 'none';
        }
        
        // Export data as JSON file
        function exportData() {
            const dataStr = JSON.stringify(allMonthsData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'duty-roster-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            document.body.appendChild(linkElement);
            
            linkElement.click();
            document.body.removeChild(linkElement);
            
            showNotification('Data exported successfully!');
        }
        
        // Import data from JSON file
        function importData() {
            const file = importFileInput.files[0];
            if (!file) {
                showNotification('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate imported data structure
                    if (typeof importedData !== 'object' || Object.keys(importedData).length === 0) {
                        showNotification('Invalid data format');
                        return;
                    }
                    
                    // Replace existing data
                    allMonthsData = importedData;
                    
                    // Set current month to first
                    currentMonthId = Object.keys(allMonthsData)[0];
                    
                    saveToLocalStorage();
                    renderTabs();
                    renderTable();
                    showNotification('Data imported successfully!');
                    
                    // Close modal
                    importModal.style.display = 'none';
                    importFileInput.value = '';
                } catch (e) {
                    console.error('Error parsing JSON file', e);
                    showNotification('Error parsing JSON file');
                }
            };
            reader.readAsText(file);
        }
        
        // Render the table
        function renderTable() {
            const currentMonthData = allMonthsData[currentMonthId];
            
            // Clear existing table
            tableHead.innerHTML = '<th>Role / Week</th>';
            tableBody.innerHTML = '';
            
            // Set month indicator
            monthIndicator.textContent = currentMonthData.name;
            
            // Create week headers
            currentMonthData.weeks.forEach((week, weekIndex) => {
                const th = document.createElement('th');
                th.textContent = week.range;
                th.classList.add('week-header');
                th.dataset.weekIndex = weekIndex;
                th.setAttribute('contenteditable', 'true');
                if (week.isCurrent) {
                    th.classList.add('current-week');
                }
                tableHead.appendChild(th);
            });
            
            // Create rows for each role
            for (const [roleName, assignments] of Object.entries(currentMonthData.roles)) {
                const row = document.createElement('tr');
                
                // Role header cell
                const roleCell = document.createElement('td');
                roleCell.textContent = roleName;
                roleCell.classList.add('role-header');
                roleCell.dataset.role = roleName;
                roleCell.setAttribute('contenteditable', 'true');
                row.appendChild(roleCell);
                
                // Assignment cells
                assignments.forEach((assignment, weekIndex) => {
                    const cell = document.createElement('td');
                    cell.classList.add('editable-cell');
                    cell.setAttribute('contenteditable', 'true');
                    cell.setAttribute('data-role', roleName);
                    cell.setAttribute('data-week', weekIndex);
                    
                    // Format content for display
                    if (assignment) {
                        cell.innerHTML = assignment.split(' & ').map(name => {
                            const isHighlighted = highlightedNames.has(name.trim());
                            const displayName = isHighlighted ? `<span class="highlight">${name}</span>` : name;
                            
                            // Mark copied content in red
                            if (currentMonthData.copiedFrom && assignment.trim()) {
                                return `<span class="copied-content">${displayName}</span>`;
                            }
                            return displayName;
                        }).join(' & ');
                    }
                    
                    if (currentMonthData.weeks[weekIndex].isCurrent) {
                        cell.classList.add('current-week');
                    }
                    
                    row.appendChild(cell);
                });
                
                tableBody.appendChild(row);
            }
            
            // Add event listeners to editable cells
            document.querySelectorAll('.editable-cell').forEach(cell => {
                cell.addEventListener('blur', handleCellEdit);
                cell.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
            
            // Add event listeners to role headers
            document.querySelectorAll('.role-header').forEach(header => {
                header.addEventListener('blur', handleRoleEdit);
                header.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
            
            // Add event listeners to week headers
            document.querySelectorAll('.week-header').forEach(header => {
                header.addEventListener('blur', handleWeekEdit);
                header.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            });
            
            // Apply highlighting rules
            applyHighlightingRules();
        }
        
        // Handle role edits
        function handleRoleEdit(e) {
            const cell = e.target;
            const oldRoleName = cell.dataset.role;
            const newRoleName = cell.textContent.trim();
            
            if (!newRoleName || newRoleName === oldRoleName) {
                cell.textContent = oldRoleName;
                return;
            }
            
            const currentMonthData = allMonthsData[currentMonthId];
            
            // Update role name in data structure
            const assignments = currentMonthData.roles[oldRoleName];
            delete currentMonthData.roles[oldRoleName];
            currentMonthData.roles[newRoleName] = assignments;
            
            // Update dataset
            cell.dataset.role = newRoleName;
            
            // Update all assignment cells with new role name
            document.querySelectorAll(`[data-role="${oldRoleName}"]`).forEach(cell => {
                cell.setAttribute('data-role', newRoleName);
            });
            
            saveToLocalStorage();
            showNotification('Role name updated successfully!');
        }
        
        // Handle week edits
        function handleWeekEdit(e) {
            const cell = e.target;
            const weekIndex = parseInt(cell.dataset.weekIndex);
            const newRange = cell.textContent.trim();
            
            if (!newRange) {
                // Revert to original value
                cell.textContent = allMonthsData[currentMonthId].weeks[weekIndex].range;
                return;
            }
            
            // Update week range in data structure
            allMonthsData[currentMonthId].weeks[weekIndex].range = newRange;
            
            saveToLocalStorage();
            showNotification('Week range updated successfully!');
        }
        
        // Apply highlighting rules
        function applyHighlightingRules() {
            const currentMonthData = allMonthsData[currentMonthId];
            const roles = currentMonthData.roles;
            
            // Reset previous highlighting
            document.querySelectorAll('.duplicate-highlight, .adjacent-highlight').forEach(el => {
                el.classList.remove('duplicate-highlight', 'adjacent-highlight');
            });
            
            // Highlight duplicates in the same column
            for (const weekIndex in currentMonthData.weeks) {
                const nameCounts = {};
                
                // Count name occurrences in this week
                for (const roleName in roles) {
                    const assignment = roles[roleName][weekIndex];
                    if (assignment) {
                        const names = assignment.split(' & ').map(name => name.trim());
                        names.forEach(name => {
                            if (name) {
                                nameCounts[name] = (nameCounts[name] || 0) + 1;
                            }
                        });
                    }
                }
                
                // Highlight duplicates
                for (const roleName in roles) {
                    const assignment = roles[roleName][weekIndex];
                    if (assignment) {
                        const names = assignment.split(' & ').map(name => name.trim());
                        const hasDuplicate = names.some(name => name && nameCounts[name] > 1);
                        
                        if (hasDuplicate) {
                            const cell = document.querySelector(`td[data-role="${roleName}"][data-week="${weekIndex}"]`);
                            if (cell) cell.classList.add('duplicate-highlight');
                        }
                    }
                }
            }
            
            // Highlight names that appear in adjacent columns
            for (const roleName in roles) {
                for (let weekIndex = 0; weekIndex < currentMonthData.weeks.length; weekIndex++) {
                    const currentAssignment = roles[roleName][weekIndex];
                    if (!currentAssignment) continue;
                    
                    const currentNames = new Set(currentAssignment.split(' & ').map(name => name.trim()));
                    
                    // Check previous week
                    if (weekIndex > 0) {
                        const prevAssignment = roles[roleName][weekIndex - 1];
                        if (prevAssignment) {
                            const prevNames = new Set(prevAssignment.split(' & ').map(name => name.trim()));
                            const hasMatch = [...currentNames].some(name => name && prevNames.has(name));
                            
                            if (hasMatch) {
                                const currentCell = document.querySelector(`td[data-role="${roleName}"][data-week="${weekIndex}"]`);
                                const prevCell = document.querySelector(`td[data-role="${roleName}"][data-week="${weekIndex - 1}"]`);
                                if (currentCell) currentCell.classList.add('adjacent-highlight');
                                if (prevCell) prevCell.classList.add('adjacent-highlight');
                            }
                        }
                    }
                    
                    // Check next week
                    if (weekIndex < currentMonthData.weeks.length - 1) {
                        const nextAssignment = roles[roleName][weekIndex + 1];
                        if (nextAssignment) {
                            const nextNames = new Set(nextAssignment.split(' & ').map(name => name.trim()));
                            const hasMatch = [...currentNames].some(name => name && nextNames.has(name));
                            
                            if (hasMatch) {
                                const currentCell = document.querySelector(`td[data-role="${roleName}"][data-week="${weekIndex}"]`);
                                const nextCell = document.querySelector(`td[data-role="${roleName}"][data-week="${weekIndex + 1}"]`);
                                if (currentCell) currentCell.classList.add('adjacent-highlight');
                                if (nextCell) nextCell.classList.add('adjacent-highlight');
                            }
                        }
                    }
                }
            }
        }
        
        // Handle cell edits
        function handleCellEdit(e) {
            const cell = e.target;
            const role = cell.getAttribute('data-role');
            const weekIndex = parseInt(cell.getAttribute('data-week'));
            
            // Update data
            allMonthsData[currentMonthId].roles[role][weekIndex] = cell.textContent;
            
            // Remove copied status for edited cell
            if (allMonthsData[currentMonthId].copiedFrom) {
                // Remove copied styling from this cell
                const spans = cell.querySelectorAll('span.copied-content');
                if (spans.length > 0) {
                    spans.forEach(span => {
                        span.outerHTML = span.innerHTML;
                    });
                }
            }
            
            // Save changes
            saveToLocalStorage();
            
            // Reapply highlighting rules
            applyHighlightingRules();
        }
        
        // Handle search functionality
        function handleSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            highlightedNames.clear();
            
            if (searchTerm.length > 1) {
                const currentMonthData = allMonthsData[currentMonthId];
                
                // Search through all names
                for (const assignments of Object.values(currentMonthData.roles)) {
                    for (const assignment of assignments) {
                        const names = assignment.split(' & ').map(name => name.trim());
                        names.forEach(name => {
                            if (name.toLowerCase().includes(searchTerm)) {
                                highlightedNames.add(name);
                            }
                        });
                    }
                }
            }
            
            renderTable();
        }
        
        // Calculate statistics
        function calculateStatistics() {
            const stats = {};
            const roleStats = {};
            
            // Iterate over all months
            for (const monthId in allMonthsData) {
                const month = allMonthsData[monthId];
                
                // Iterate over roles
                for (const role in month.roles) {
                    // Initialize role in roleStats if needed
                    if (!roleStats[role]) {
                        roleStats[role] = {};
                    }
                    
                    // Iterate over each week assignment in the role
                    month.roles[role].forEach(assignment => {
                        // Split by ' & ' to get multiple names
                        const names = assignment.split(' & ').map(name => name.trim()).filter(name => name !== '');
                        
                        names.forEach(name => {
                            // Update overall stats
                            if (!stats[name]) {
                                stats[name] = { total: 0, roles: {} };
                            }
                            stats[name].total += 1;
                            
                            // Update role-specific count for this person
                            if (!stats[name].roles[role]) {
                                stats[name].roles[role] = 0;
                            }
                            stats[name].roles[role] += 1;
                            
                            // Update role-specific stats
                            if (!roleStats[role][name]) {
                                roleStats[role][name] = 0;
                            }
                            roleStats[role][name] += 1;
                        });
                    });
                }
            }
            
            return { stats, roleStats };
        }
        
        // Show statistics modal
        function showStatisticsModal() {
            // Calculate statistics
            const { stats, roleStats } = calculateStatistics();
            
            // Convert to array and sort by total descending
            const statsArray = Object.entries(stats).map(([name, data]) => ({
                name,
                total: data.total,
                roles: data.roles
            }));
            
            statsArray.sort((a, b) => b.total - a.total);
            
            // Clear previous content
            topAssigneesTable.innerHTML = '';
            detailedStatsTable.innerHTML = '';
            roleBreakdown.innerHTML = '';
            
            // Populate top assignees table (top 5)
            statsArray.slice(0, 5).forEach((person, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank">${index + 1}</td>
                    <td>${person.name}</td>
                    <td class="count">${person.total}</td>
                `;
                topAssigneesTable.appendChild(row);
            });
            
            // Populate detailed stats table
            statsArray.forEach(person => {
                const row = document.createElement('tr');
                
                // Format role breakdown
                const roleBreakdown = Object.entries(person.roles)
                    .map(([role, count]) => `${role}: ${count}`)
                    .join(', ');
                
                row.innerHTML = `
                    <td>${person.name}</td>
                    <td class="count">${person.total}</td>
                    <td class="role-count">${roleBreakdown}</td>
                `;
                detailedStatsTable.appendChild(row);
            });
            
            // Populate role breakdown
            const roleCards = document.createElement('div');
            roleCards.className = 'role-breakdown';
            
            for (const role in roleStats) {
                const roleCard = document.createElement('div');
                roleCard.className = 'role-card';
                
                const roleTitle = document.createElement('h4');
                roleTitle.textContent = role;
                
                const roleList = document.createElement('ul');
                
                // Convert role assignments to array and sort by count descending
                const roleAssignments = Object.entries(roleStats[role])
                    .map(([name, count]) => ({ name, count }))
                    .sort((a, b) => b.count - a.count);
                
                // Add top 5 assignments for this role
                roleAssignments.slice(0, 5).forEach(assignment => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${assignment.name}</span>
                        <span class="count">${assignment.count}</span>
                    `;
                    roleList.appendChild(li);
                });
                
                roleCard.appendChild(roleTitle);
                roleCard.appendChild(roleList);
                roleCards.appendChild(roleCard);
            }
            
            roleBreakdown.appendChild(roleCards);
            
            // Show modal
            statsModal.style.display = 'flex';
        }
        
        // Reset to default data
        function resetData() {
            if (confirm('Are you sure you want to reset ALL tables to default? This cannot be undone.')) {
                allMonthsData = JSON.parse(JSON.stringify(defaultData));
                currentMonthId = 'july';
                saveToLocalStorage();
                renderTabs();
                renderTable();
                showNotification('All tables reset to default values');
            }
        }
        
        // Show instructions modal
        function showInstructionsModal() {
            instructionsModal.style.display = 'flex';
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Month navigation
            document.getElementById('prevMonthBtn').addEventListener('click', () => {
                const monthIds = Object.keys(allMonthsData);
                const currentIndex = monthIds.indexOf(currentMonthId);
                const prevIndex = (currentIndex - 1 + monthIds.length) % monthIds.length;
                currentMonthId = monthIds[prevIndex];
                renderTabs();
                renderTable();
            });
            
            document.getElementById('nextMonthBtn').addEventListener('click', () => {
                const monthIds = Object.keys(allMonthsData);
                const currentIndex = monthIds.indexOf(currentMonthId);
                const nextIndex = (currentIndex + 1) % monthIds.length;
                currentMonthId = monthIds[nextIndex];
                renderTabs();
                renderTable();
            });
            
            document.getElementById('currentMonthBtn').addEventListener('click', () => {
                // Set to the original current month (July)
                if (allMonthsData.july) {
                    currentMonthId = 'july';
                    renderTabs();
                    renderTable();
                }
            });
            
            // Print button
            document.getElementById('printBtn').addEventListener('click', () => {
                window.print();
            });
            
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', resetData);
            
            // Add table button
            document.getElementById('addTableBtn').addEventListener('click', openAddTableModal);
            
            // Export button
            document.getElementById('exportBtn').addEventListener('click', exportData);
            
            // Import button
            document.getElementById('importBtn').addEventListener('click', () => {
                importFileInput.value = '';
                importModal.style.display = 'flex';
            });
            
            // Statistics button
            document.getElementById('statsBtn').addEventListener('click', showStatisticsModal);
            
            // Info button
            document.getElementById('infoBtn').addEventListener('click', showInstructionsModal);
            
            // Search functionality
            searchInput.addEventListener('input', handleSearch);
            
            // Modal close buttons
            document.querySelectorAll('.close-modal, #cancelAddTableBtn, #cancelImportBtn, #closeStatsBtn, #closeInstructionsBtn').forEach(btn => {
                btn.addEventListener('click', () => {
                    addTableModal.style.display = 'none';
                    importModal.style.display = 'none';
                    statsModal.style.display = 'none';
                    instructionsModal.style.display = 'none';
                });
            });
            
            // Confirm add table
            document.getElementById('confirmAddTableBtn').addEventListener('click', createNewTable);
            
            // Confirm import
            document.getElementById('confirmImportBtn').addEventListener('click', importData);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === addTableModal) {
                    addTableModal.style.display = 'none';
                }
                if (e.target === importModal) {
                    importModal.style.display = 'none';
                }
                if (e.target === statsModal) {
                    statsModal.style.display = 'none';
                }
                if (e.target === instructionsModal) {
                    instructionsModal.style.display = 'none';
                }
            });
        }
        
        // Initialize the app
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>